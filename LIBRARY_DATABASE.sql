CREATE TABLE PUBLISHER(
NAME VARCHAR(20) PRIMARY KEY,
PHONE INTEGER,
ADDR VARCHAR(20));

DESC PUBLISHER;

CREATE TABLE BOOK( 
BOOK_ID INTEGER PRIMARY KEY, 
TITLE VARCHAR(20), 
NAME VARCHAR(20),
PUB_YEAR VARCHAR(20), 
FOREIGN KEY(NAME) REFERENCES PUBLISHER(NAME) ON DELETE CASCADE);

DESC BOOK;

CREATE TABLE BOOK_AUTHORS( 
BOOK_ID INTEGER,
AUTHOR_NAME VARCHAR(20), 
FOREIGN KEY(BOOK_ID) REFERENCES BOOK(BOOK_ID)  ON DELETE CASCADE, 
PRIMARY KEY(BOOK_ID, AUTHOR_NAME));

DESC BOOK_AUTHORS;

CREATE TABLE LIBRARY_BRANCH( 
BRANCH_ID INTEGER PRIMARY KEY, 
BRANCH_NAME VARCHAR(20), 
ADDR VARCHAR(20));

DESC LIBRARY_BRANCH;

CREATE TABLE BOOK_COPIES( 
BOOK_ID INTEGER, 
BRANCH_ID INTEGER, 
NO_OF_COPIES INTEGER, 
PRIMARY KEY(BOOK_ID,BRANCH_ID), 
FOREIGN KEY(BOOK_ID) REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE, 
FOREIGN KEY(BRANCH_ID) REFERENCES LIBRARY_BRANCH(BRANCH_ID) ON DELETE CASCADE);

DESC BOOK_COPIES;

CREATE TABLE BOOK_LENDING(
BOOK_ID INTEGER, 
BRANCH_ID INTEGER, 
CARD_NO INTEGER, 
DATE_OUT DATE, 
DUE_DATE DATE, 
PRIMARY KEY(BOOK_ID,BRANCH_ID, CARD_NO), 
FOREIGN KEY(BOOK_ID) REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE,   
FOREIGN KEY(BRANCH_ID) REFERENCES LIBRARY_BRANCH(BRANCH_ID) ON DELETE CASCADE);

DESC BOOK_LENDING;

INSERT INTO BOOK VALUES(1,'BASICS OF EXCEL','SAPNA','JAN-2017');
INSERT INTO BOOK VALUES(2,'PROGRAMMING','PLANETZ','JUN-2018');
INSERT INTO BOOK VALUES(3,'BASICS OF SQL','PEARSON','SEP-2016');
INSERT INTO BOOK VALUES(4,'DBMS FOR BEGINNERS','PLANETZ','SEP-2015');
INSERT INTO BOOK VALUES(5,'WEB SERVICES','OZONE','MAY-2017');
SELECT * FROM BOOK;

INSERT INTO BOOK_AUTHORS VALUES(1,'SRI DEVI');
INSERT INTO BOOK_AUTHORS VALUES(2,'DEEPAK');
INSERT INTO BOOK_AUTHORS VALUES(3,'PRAMOD');
INSERT INTO BOOK_AUTHORS VALUES(4,'SWATHI');
INSERT INTO BOOK_AUTHORS VALUES(5,'PRATHIMA');
SELECT * FROM BOOK_AUTHORS;

INSERT INTO LIBRARY_BRANCH VALUES(101,'ABC','BENG');
INSERT INTO LIBRARY_BRANCH VALUES(102,'DEF','BENG');
INSERT INTO LIBRARY_BRANCH VALUES(103,'GHI','WHITE');
INSERT INTO LIBRARY_BRANCH VALUES(104,'JKL','ITPL');
INSERT INTO LIBRARY_BRANCH VALUES(105,'MNO','BANK');
SELECT * FROM LIBRARY_BRANCH;

INSERT INTO BOOK_COPIES VALUES(1,101,4);
INSERT INTO BOOK_COPIES VALUES(2,102,10);
INSERT INTO BOOK_COPIES VALUES(3,102,5);
INSERT INTO BOOK_COPIES VALUES(4,104,20);
INSERT INTO BOOK_COPIES VALUES(5,105,24);
INSERT INTO BOOK_COPIES VALUES(4,105,21);
INSERT INTO BOOK_COPIES VALUES(2,102,15);
SELECT * FROM BOOK_COPIES;

INSERT INTO BOOK_LENDING VALUES(1,101,123,'2017-01-01','2017-01-07');
INSERT INTO BOOK_LENDING VALUES(2,102,456,'2017-01-02','2017-01-08');
INSERT INTO BOOK_LENDING VALUES(3,102,456,'2017-01-02','2017-01-08');
INSERT INTO BOOK_LENDING VALUES(4,105,456,'2017-01-08','2017-01-16');
INSERT INTO BOOK_LENDING VALUES(5,102,789,'2017-01-16','2017-01-27');
INSERT INTO BOOK_LENDING VALUES(5,102,789,'2017-05-16','2017-06-27');
INSERT INTO BOOK_LENDING VALUES(5,102,799,'2017-01-16','2017-02-27');
INSERT INTO BOOK_LENDING VALUES(1,104,133,'2017-03-01','2017-04-07');
INSERT INTO BOOK_LENDING VALUES(1,101,143,'2017-04-01','2017-06-07');
SELECT * FROM BOOK_LENDING;

QUERIES:
1.
SELECT C.BRANCH_ID,B.BOOK_ID, B.TITLE, B.NAME, A.AUTHOR_NAME, C.NO_OF_COPIES 
FROM BOOK B, BOOK_AUTHORS A, BOOK_COPIES C 
WHERE B.BOOK_ID=A.BOOK_ID AND B.BOOK_ID=C.BOOK_ID 
ORDER BY C.BRANCH_ID;

2.
SELECT CARD_NO 
FROM BOOK_LENDING 
WHERE DATE_OUT BETWEEN '2021-01-01' AND '2021-06-30' 
GROUP BY CARD_NO 
HAVING COUNT(*)>3;

3.
DELETE FROM BOOK WHERE BOOK_ID=1;
SELECT * FROM BOOK;
SELECT * FROM BOOK_LENDING;

4.
 create table book1(
book_id int not null,
title varchar(20),
name varchar(20) ,
pub_year int,
primary key(book_id,pub_year)
)
PARTITION BY RANGE (pub_year) (
PARTITION p0 VALUES LESS THAN (1991),
PARTITION p1 VALUES LESS THAN (1995),
PARTITION p2 VALUES LESS THAN (1999),
PARTITION p3 VALUES LESS THAN (2003),
PARTITION p4 VALUES LESS THAN (2007));

SELECT * FROM BOOK1 PARTITION(P1);
SELECT BOOK_ID, TITLE,NAME,PUB_YEAR FROM BOOK GROUP BY PUB_YEAR, BOOK_ID, TITLE,NAME;

5.
 CREATE VIEW TOTAL_BOOKS AS 
SELECT BOOK_ID,SUM(NO_OF_COPIES) AS SUM 
FROM BOOK_COPIES GROUP BY BOOK_ID;

CREATE VIEW BOOKS_BORROWED AS 
SELECT BOOK_ID, COUNT(*) AS SUM 
FROM BOOK_LENDING 
GROUP BY BOOK_ID;

CREATE VIEW BOOKS_AVAILABLE AS 
SELECT A.BOOK_ID,IFNULL(A.SUM-B.SUM,A.SUM) AS NO_OF_BOOKS_AVAILABLE 
FROM TOTAL_BOOKS A LEFT OUTER JOIN BOOKS_BORROWED B ON A.BOOK_ID =B.BOOK_ID;
